const a99_0x38a886=a99_0x2af8;function a99_0x2af8(_0x1a073d,_0x2df912){const _0x5a3448=a99_0x5a34();return a99_0x2af8=function(_0x2af85b,_0xfc2fde){_0x2af85b=_0x2af85b-0x14d;let _0x30b08e=_0x5a3448[_0x2af85b];return _0x30b08e;},a99_0x2af8(_0x1a073d,_0x2df912);}(function(_0x2b451c,_0x4821a9){const _0x1bc14b=a99_0x2af8,_0x436207=_0x2b451c();while(!![]){try{const _0x54eb41=-parseInt(_0x1bc14b(0x15e))/0x1+parseInt(_0x1bc14b(0x15f))/0x2+parseInt(_0x1bc14b(0x184))/0x3+-parseInt(_0x1bc14b(0x195))/0x4*(parseInt(_0x1bc14b(0x162))/0x5)+parseInt(_0x1bc14b(0x178))/0x6*(parseInt(_0x1bc14b(0x18b))/0x7)+parseInt(_0x1bc14b(0x189))/0x8+parseInt(_0x1bc14b(0x174))/0x9;if(_0x54eb41===_0x4821a9)break;else _0x436207['push'](_0x436207['shift']());}catch(_0xf82ead){_0x436207['push'](_0x436207['shift']());}}}(a99_0x5a34,0xd97ee));function a99_0x5a34(){const _0x42b892=['TkFAc','714dwuYFr','path','exec','klViB','percyOptions','Percy\x20config\x20created\x20at\x20','http://localhost:5338','healthcheck','isRunning','stderr','4937228YkzHwN','version','isProcessRunning','../helper','percy.log','error','../../helpers/performance/performance-tester','BBqBC','writeFile','fetchPercyToken','HSXLj','debug','nbyva','&type=','flags','exec:stop','token','Error\x20creating\x20percy\x20config:\x20','start','end','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','PERCY_SERVER_ADDRESS','GET','1745920hCvRFK','434260OszytW','../logger','automate','5sJFxLA','./PercyBinary','oXlbM','QRGFd','close','YsdgS','zOTQG','FXrHH','join','BROWSERSTACK_TESTHUB_UUID','exports','KkklJ','GdDvQ','app','DOWNLOAD','percy.json','Percy\x20healthcheck\x20successful','qJjdW','10469871oKEfsQ','xUWRL','assign','stop','34926TIdgvF','EoQiu','ZiNRS','lKhmd','SfQxi','env','createWriteStream','JYKRK','api/app_percy/get_project_token?name=','ENV_VAR','../../helpers/performance/constants','Percy\x20fetch\x20token\x20success','3894882PzkFaU','nodeRequest','createPercyConfig','projectName','CctSn','4788832XOCSbw'];a99_0x5a34=function(){return _0x42b892;};return a99_0x5a34();}const fs=require('fs'),path=require(a99_0x38a886(0x18c)),os=require('os'),{spawn}=require('child_process'),helper=require(a99_0x38a886(0x198)),logger=require('../logger')['winstonLogger'],{getLogDir}=require(a99_0x38a886(0x160)),testHubConstants=require('../../helpers/testhub/constants'),PerformanceTester=require(a99_0x38a886(0x14d)),{PERCY_EVENTS:PerformanceEvents}=require(a99_0x38a886(0x182)),PercyBinary=require(a99_0x38a886(0x163));class Percy{#logfile=path[a99_0x38a886(0x16a)](getLogDir(),a99_0x38a886(0x199));#address=process[a99_0x38a886(0x17d)][a99_0x38a886(0x15c)]||a99_0x38a886(0x191);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a99_0x38a886(0x197)]=![];constructor(_0x3be94b){const _0x1778c2=a99_0x38a886;this.#config=_0x3be94b,!!_0x3be94b[_0x1778c2(0x16f)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x50908f=a99_0x38a886;if(!this.#binaryPath){const _0x3cc1ec=new PercyBinary();PerformanceTester[_0x50908f(0x159)](PerformanceEvents[_0x50908f(0x170)]),this.#binaryPath=await _0x3cc1ec['getBinaryPath'](this.#config),PerformanceTester[_0x50908f(0x15a)](PerformanceEvents[_0x50908f(0x170)]);}return this.#binaryPath;}async #sleep(_0x1ff340){return new Promise(_0x141435=>setTimeout(_0x141435,_0x1ff340));}async[a99_0x38a886(0x192)](){const _0x4aeaad=a99_0x38a886,_0x1cd313={};_0x1cd313[_0x4aeaad(0x165)]=_0x4aeaad(0x15d),_0x1cd313[_0x4aeaad(0x179)]='percy/healthcheck';const _0x36f6e2=_0x1cd313;try{const _0x54c7c7=await helper[_0x4aeaad(0x185)](_0x36f6e2['QRGFd'],_0x36f6e2[_0x4aeaad(0x179)],null,null,this.#address);if(_0x54c7c7)return!![];}catch(_0x452dea){return![];}}async[a99_0x38a886(0x159)](){const _0x17c1d9=a99_0x38a886,_0x37c1ca={'GdDvQ':'app:exec','HSXLj':_0x17c1d9(0x18d),'klViB':function(_0x5ecf25,_0x543322,_0x52b894,_0x12f0c2){return _0x5ecf25(_0x543322,_0x52b894,_0x12f0c2);},'JYKRK':'close','xUWRL':_0x17c1d9(0x172)},_0x11372f=await this.#getBinaryPath(),_0x2bc856={};_0x2bc856[_0x17c1d9(0x155)]='a';const _0x26b2bc=fs[_0x17c1d9(0x17e)](this.#logfile,_0x2bc856),_0x2e9d3b=await this[_0x17c1d9(0x150)](),_0x297a45=await this[_0x17c1d9(0x186)]();if(!_0x2e9d3b)return![];const _0x3a399=[(this.#isApp?_0x37c1ca[_0x17c1d9(0x16e)]:_0x37c1ca[_0x17c1d9(0x151)])+':start'];_0x297a45&&_0x3a399['push']('-c',_0x297a45);this.#proc=_0x37c1ca[_0x17c1d9(0x18e)](spawn,_0x11372f,_0x3a399,{'env':Object[_0x17c1d9(0x176)](process[_0x17c1d9(0x17d)],{'PERCY_TOKEN':_0x2e9d3b,'TH_BUILD_UUID':process[_0x17c1d9(0x17d)][testHubConstants[_0x17c1d9(0x181)][_0x17c1d9(0x16b)]]})}),this.#proc['stdout']['pipe'](_0x26b2bc),this.#proc[_0x17c1d9(0x194)]['pipe'](_0x26b2bc),this[_0x17c1d9(0x197)]=!![];var _0x240858=this;this.#proc['on'](_0x37c1ca[_0x17c1d9(0x17f)],function(_0x4936ee){const _0x377d26=_0x17c1d9;_0x240858[_0x377d26(0x197)]=![];});do{const _0x42db09=await this[_0x17c1d9(0x192)]();if(_0x42db09)return logger[_0x17c1d9(0x152)](_0x37c1ca[_0x17c1d9(0x175)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a99_0x38a886(0x177)](){const _0xa05df=a99_0x38a886,_0x32fee3={'ucUjs':function(_0x751a46,_0xb46fe7){return _0x751a46(_0xb46fe7);},'TkFAc':function(_0x5dd533,_0xf9778f,_0x4fae90){return _0x5dd533(_0xf9778f,_0x4fae90);},'SfQxi':_0xa05df(0x156),'KkklJ':_0xa05df(0x166)},_0x236d2f=await this.#getBinaryPath();return new Promise((_0x516aaf,_0x5d130c)=>{const _0x1b693f=_0xa05df,_0x5d1549={'lKhmd':function(_0x366959,_0x759a8e){return _0x32fee3['ucUjs'](_0x366959,_0x759a8e);}},_0x520c4f=_0x32fee3[_0x1b693f(0x18a)](spawn,_0x236d2f,[_0x32fee3[_0x1b693f(0x17c)]]);_0x520c4f['on'](_0x32fee3[_0x1b693f(0x16d)],_0x16d30b=>{const _0x3677bc=_0x1b693f;this[_0x3677bc(0x197)]=![],_0x5d1549[_0x3677bc(0x17b)](_0x516aaf,_0x16d30b);});});}[a99_0x38a886(0x193)](){return this['isProcessRunning'];}async[a99_0x38a886(0x150)](){const _0x543f17=a99_0x38a886,_0x2588fe={};_0x2588fe[_0x543f17(0x173)]='app',_0x2588fe[_0x543f17(0x153)]=_0x543f17(0x161),_0x2588fe[_0x543f17(0x188)]='GET',_0x2588fe['FXrHH']=_0x543f17(0x183);const _0x15dd5d=_0x2588fe,_0x1e609e=this.#config[_0x543f17(0x187)];try{const _0x1ca93e=this.#isApp?_0x15dd5d[_0x543f17(0x173)]:_0x15dd5d[_0x543f17(0x153)],_0x218490=await helper[_0x543f17(0x185)](_0x15dd5d[_0x543f17(0x188)],_0x543f17(0x180)+_0x1e609e+_0x543f17(0x154)+_0x1ca93e,{},this.#config),_0x4a7c76=_0x218490['data'];return logger[_0x543f17(0x152)](_0x15dd5d[_0x543f17(0x169)]),_0x4a7c76[_0x543f17(0x157)];}catch(_0x44282a){return logger[_0x543f17(0x19a)](_0x543f17(0x15b)+_0x44282a),null;}}async[a99_0x38a886(0x186)](){const _0x30a5c6=a99_0x38a886,_0xf6cb69={'oXlbM':function(_0x3ddf73,_0x423845){return _0x3ddf73(_0x423845);},'zOTQG':function(_0x56fcd3,_0x11e8b3){return _0x56fcd3+_0x11e8b3;},'UsBFy':_0x30a5c6(0x190),'ZiNRS':_0x30a5c6(0x171)};if(!this.#config[_0x30a5c6(0x18f)])return null;const _0x2ac4fa=path[_0x30a5c6(0x16a)](os['tmpdir'](),_0xf6cb69[_0x30a5c6(0x17a)]),_0x58cf7e=this.#config['percyOptions'];return!_0x58cf7e[_0x30a5c6(0x196)]&&(_0x58cf7e[_0x30a5c6(0x196)]='2'),new Promise((_0x34dc70,_0xacc8db)=>{const _0x7b04ef=_0x30a5c6,_0x579439={'BBqBC':function(_0x134dfc,_0x3534c8){const _0x143c3a=a99_0x2af8;return _0xf6cb69[_0x143c3a(0x164)](_0x134dfc,_0x3534c8);},'YsdgS':function(_0xb9c889,_0x2a143f){const _0x461699=a99_0x2af8;return _0xf6cb69[_0x461699(0x168)](_0xb9c889,_0x2a143f);},'KAXOI':_0xf6cb69['UsBFy']};fs[_0x7b04ef(0x14f)](_0x2ac4fa,JSON['stringify'](_0x58cf7e),_0x5436f2=>{const _0x1f8c62=_0x7b04ef;_0x5436f2&&(logger[_0x1f8c62(0x19a)](_0x1f8c62(0x158)+_0x5436f2),_0x579439[_0x1f8c62(0x14e)](_0x34dc70,null)),logger[_0x1f8c62(0x152)](_0x579439[_0x1f8c62(0x167)](_0x579439['KAXOI'],_0x2ac4fa)),_0x579439[_0x1f8c62(0x14e)](_0x34dc70,_0x2ac4fa);});});}}module[a99_0x38a886(0x16c)]=Percy;